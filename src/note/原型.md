## new 做了什么
* 实现一个对象:
* 链接到原型: `__proto__`（隐式原型属性）赋值为`prototype`（显示原型属性）
* 绑定this，执行构造函数
* 返回新对象

## 实现 instanceof
```javascript
function instanceof(left,right){
  let prototype = right.prototype;
  left = left.__proto__;
  while(true){
    if(left === null) return false;
    if(left === prototype) return true;
    left = left.__proto__;
  }
}
(new Number()) instanceof Number //true
```
##闭包问题
```javascript
for(var i=0;i<10;i++){
  setTimeout(i=>console.log(i))
}
//10个undefined
```
setTimeout是异步的setTimeout 后面跟着的i 相当于 `(var i)=>console.log(i) `实质上和for循环中的i无关
```javascript
for(var i =0;i<10;i++){
  setTimeout(()=>console.log(i))
}
//10个10
```
解决方式一：采用闭包
```javascript
for(var i=0;i<10;i++){
  (function(i){setTimeout(()=>console.log(i))})(i)
}
// 0 1 2 3 4 5 6 7 8 9
```
解决方式二：使用setTimeout的第三个参数
```javascript
for(var i = 0;i<10;i++){
  setTimeout((i)=>console.log(i),0,i)
}
// 0 1 2 3 4 5 6 7 8 9
```
解决方法三：使用let
```javascript
for(let i=0;i<10;i++){
  setTimeout(()=>console.log(i))
}
// 0 1 2 3 4 5 6 7 8 9
```
